from tagth.tagth import allowed, _normalize_resource

def test_v_principal_access_whitespace_resource():
    # Vulnerability check:
    # A resource with only whitespace (e.g. ' ') normalizes to [('void', 'all')]
    # Since 'void' starts with 'v', the principal 'v' matches it.

    p = 'v'
    r = ' '
    a = 'read'

    # Before fix, this assertion fails because allowed returns True
    # After fix, allowed should return False
    assert not allowed(p, r, a), "Principal 'v' should NOT access whitespace resource"

def test_empty_resource_behavior():
    # Empty resource string '' currently normalizes to [].
    # But whitespace ' ' normalizes to [('void', 'all')].
    # This confirms the normalization that causes the issue.
    # After fix, it should normalize to something that 'v' doesn't match.

    # We can check normalization result directly if needed, but 'allowed' test covers the security impact.
    pass
